<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>BFSI Voice Agent â€” Dashboard</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <div class="top-panel">
    <h2>ğŸ‘¤ Customer Snapshot â€” <span id="cust-name">Aarav Sharma</span></h2>
    <div class="info-grid">
      <div>ğŸ’° Balance: â‚¹<span id="balance">125430</span></div>
      <div>ğŸ’³ Card: <span id="card">Active</span></div>
      <div>ğŸ  EMI Due: <span id="emi">Nov 5, 2025</span></div>
      <div>ğŸ©º Claim: <span id="claim">Under Review</span></div>
    </div>
  </div>

  <div class="container">
    <div class="left">
      <img src="https://cdn-icons-png.flaticon.com/512/2920/2920348.png" class="logo" onclick="startCall()" alt="Call Agent" />
      <h3>Call Agent</h3>
      <div class="examples">
        <h4>Try saying:</h4>
        <ul>
          <li>Whatâ€™s my balance?</li>
          <li>Block my card</li>
          <li>When is my next EMI due?</li>
          <li>Whatâ€™s my claim status?</li>
        </ul>
      </div>
    </div>

    <div class="right">
      <h2>ğŸ—£ï¸ Conversation</h2>
      <div id="chat-log"></div>
    </div>
  </div>

  <script>
    async function startCall() {
      const res = await fetch('/start-call');
      const data = await res.json();
      if (data.error) alert("Error: " + data.error);
      else alert(data.status + (data.sid ? " â€” " + data.sid : ""));
    }

    async function refreshChat() {
      const res = await fetch('/conversation');
      const obj = await res.json();
      const log = document.getElementById('chat-log');
      log.innerHTML = obj.chat.map(c =>
        `<div class="msg ${c.role}"><strong>${c.role}:</strong> ${c.text}</div>`
      ).join('');
    }

    async function refreshDemo() {
      // fetch optional demo-data if needed (already rendered server-side)
      // placeholder for future
    }

    setInterval(refreshChat, 2000);
    setInterval(refreshDemo, 5000);
    window.onload = () => { refreshChat(); refreshDemo(); };
  </script>
</body>
</html>
